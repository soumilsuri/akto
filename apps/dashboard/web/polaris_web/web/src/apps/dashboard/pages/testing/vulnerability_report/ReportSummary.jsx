import { Box, Text, VerticalStack } from '@shopify/polaris'
import React from 'react'
import ReportSummaryInfoCard from './ReportSummaryInfoCard'
import ChartypeComponent from '../TestRunsPage/ChartypeComponent'
import BarGraph from '../../../components/charts/BarGraph'
import ReportTestConfiguration from './ReportTestConfiguration'

const ReportSummary = ({ reportSummaryItems, severityMap, graphData, organizationName, currentDate, reportTestConfigurationData }) => {

    const showTestingConfig = window.location.pathname.includes('testing') && reportTestConfigurationData && Object.keys(reportTestConfigurationData).length > 0

    return (
        <Box id="report-summary" paddingBlockStart={6} paddingBlockEnd={6} paddingInlineStart={5} paddingInlineEnd={5}>
            <VerticalStack gap="4">
                <Text variant="headingLg">1. Report summary</Text>
                <VerticalStack gap="3">
                    <Text variant="bodyMd" color='subdued'>
                        The initial security assessment conducted on {currentDate} focused on evaluating core functionalities of <span id='organization-name'>{organizationName}</span>'s API endpoints. The scan was configured to analyze authentication mechanisms, data validation controls, access management, and potential security misconfigurations to identify vulnerabilities that could impact the application's security posture.
                    </Text>
                    <ReportSummaryInfoCard summaryItems={reportSummaryItems} />

                    <Box width='100%' paddingBlockStart={4} paddingBlockEnd={2}>
                        <VerticalStack gap={3}>
                            <Text variant="headingSm">Issues by Severity</Text>

                            <ChartypeComponent
                                data={severityMap}
                                navUrl={""} title={""} isNormal={true} boxHeight={'300px'} chartOnLeft={true} dataTableWidth="450px" boxPadding={0}
                                pieInnerSize="50%"
                                chartSize={250}
                                spaceBetween={'space-evenly'}
                            />
                        </VerticalStack>
                    </Box>

                    <Box width='100%' id='bargraph-container' paddingBlockStart={2} paddingBlockEnd={4}>
                        <VerticalStack gap={3}>
                            <Text variant="headingSm">Top 5 Categories by issues</Text>

                            <BarGraph
                                data={graphData}
                                areaFillHex="true"
                                height={"320px"}
                                showYAxis={true}
                                yAxisTitle="Number of issues"
                                barGap={12}
                                showGridLines={true}
                                defaultChartOptions={{
                                    "legend": {
                                        enabled: false
                                    },
                                }}
                                xAxisTitle={'Categories'}
                                barWidth={30}
                            />
                        </VerticalStack>
                    </Box>

                    {showTestingConfig && (
                        <Box width='100%' paddingBlockStart={4} paddingBlockEnd={2}>
                            <VerticalStack gap={3}>
                                <Text variant="headingSm">Test configuration</Text>

                                <ReportTestConfiguration reportTestConfigurationData={reportTestConfigurationData} />
                            </VerticalStack>
                        </Box>
                    )}
                </VerticalStack>
            </VerticalStack>
        </Box>
    )
}

export default ReportSummary